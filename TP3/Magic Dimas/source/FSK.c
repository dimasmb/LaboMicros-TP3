/***************************************************************************//**
  @file     FSK.c
  @brief    Funciones para modular FSK
  @author   Dimas Bosch
 ******************************************************************************/

/*******************************************************************************
 * INCLUDE HEADER FILES
 ******************************************************************************/
#include "FSK.h"


/*******************************************************************************
 * CONSTANT AND MACRO DEFINITIONS USING #DEFINE
 ******************************************************************************/
#define FSK_DATA_SIZE 8


/*******************************************************************************
 * ENUMERATIONS AND STRUCTURES AND TYPEDEFS
 ******************************************************************************/
typedef struct
{
  uint16_t stop     :1;
  uint16_t parity   :1;
  uint16_t data     :8;
  uint16_t start    :1;
  uint16_t none     :5;
}FSK_t;



/*******************************************************************************
 * VARIABLES WITH GLOBAL SCOPE
 ******************************************************************************/

// +ej: unsigned int anio_actual;+


/*******************************************************************************
 * FUNCTION PROTOTYPES FOR PRIVATE FUNCTIONS WITH FILE LEVEL SCOPE
 ******************************************************************************/

// +ej: static void falta_envido (int);+


/*******************************************************************************
 * ROM CONST VARIABLES WITH FILE LEVEL SCOPE
 ******************************************************************************/

// +ej: static const int temperaturas_medias[4] = {23, 26, 24, 29};+


/*******************************************************************************
 * STATIC VARIABLES AND CONST VARIABLES WITH FILE LEVEL SCOPE
 ******************************************************************************/

// +ej: static int temperaturas_actuales[4];+


/*******************************************************************************
 *******************************************************************************
                        GLOBAL FUNCTION DEFINITIONS
 *******************************************************************************
 ******************************************************************************/

uint16_t FSK_modulation(uint8_t uart_str)
{
  static FSK_t mod;
  mod.start = 0;
  mod.stop = 1;
  mod.data = 0;
  mod.none = 0;

  uint8_t par_cont = 0;
  for(int i=0; i<FSK_DATA_SIZE ; i++)
  {
    if(uart_str & (1<<i))
    {
      mod.data |= (1<<(FSK_DATA_SIZE-1-i));
      par_cont++;
    }
    else
    {
      mod.data &= ~(1<<(FSK_DATA_SIZE-1-i));
    }
  }

  if(par_cont & (1<<0))
  {
    mod.parity = 0;
  }
  else mod.parity = 1;

  return (*(uint16_t*)&mod);
}

/*******************************************************************************
 *******************************************************************************
                        LOCAL FUNCTION DEFINITIONS
 *******************************************************************************
 ******************************************************************************/



 
